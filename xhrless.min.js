(function(g){var e="object"==typeof window&&"object"==typeof document,f="object"==typeof module&&"function"==typeof require;if("undefined"==typeof XMLHttpRequest)if(f)XMLHttpRequest=require("xhr2"),["cookie","cookie2","referer","user-agent"].forEach(function(a){return delete XMLHttpRequest.prototype._restrictedHeaders[a]});else throw Error("XMLHttpRequest is not defined in this environment");var b=function(a,c,d){if("object"!=typeof this||!(this instanceof b))return new b(a,c,d);this.xhr=new XMLHttpRequest;
this.method=d||"";this.url=a||"";this.postData=c||void 0;this.password=this.userName=void 0;this.headers={};this.data={}};b.prototype.ERR_NONE=0;b.prototype.ERR_CONNECTION=1;b.prototype.ERR_HTTPSTATUS=2;b.prototype.ERR_BODYTYPE=3;b.prototype.reset=function(a,c,b){this.method=b||"";this.url=a||"";this.postData=c||void 0;return this};b.prototype.httpAuth=function(a,c){this.userName=a;this.password=c;return this};b.prototype.setTimeout=function(a){this.xhr.timeout="number"==typeof a&&0<a?a:0;return this};
b.prototype.setData=function(a,c){"string"==typeof a&&a.length&&(void 0!==c?this.data[a]=c:this.data.hasOwnProperty(a)&&delete this.data[a]);return this};b.prototype.setHeader=function(a,c){"string"==typeof a&&a.length&&("string"==typeof c&&c.length?this.headers[a]=c:this.headers.hasOwnProperty(a)&&delete this.headers[a]);return this};b.prototype.setCookie=function(a,c){"string"==typeof a&&a.length&&"string"==typeof c&&c.length&&(this.headers.Cookie="Cookie"in this.headers?this.headers.Cookie+("; "+
a+"="+encodeURIComponent(c)):a+"="+encodeURIComponent(c));return this};b.prototype.setCookies=function(a){var c=[];if("object"==typeof a)for(var b in a)a.hasOwnProperty(b)&&"string"==typeof a[b]&&a[b].length&&c.push(b+"="+encodeURIComponent(a[b]));c.length?this.headers.Cookie=c.join("; "):this.headers.hasOwnProperty("Cookie")&&delete this.headers.Cookie;return this};b.prototype.onTimeout=function(a){var c=this;this.xhr.ontimeout=function(b){return"function"==typeof a&&a.call(c,c)};return this};b.prototype.onChange=
function(a){var c=this;this.xhr.onreadystatechange=function(b){return"function"==typeof a&&a.call(c,c)};return this};b.prototype.onReady=function(a){var c=this;this.xhr.onreadystatechange=function(b){return c.isCompleted()&&"function"==typeof a&&a.call(c,c)};return this};b.prototype.onSuccess=function(a,c){var b=this;this.xhr.onreadystatechange=function(d){b.isCompleted()&&(b.isSuccessResponse()?"function"==typeof a&&a.call(b,b):"function"==typeof c&&c.call(b,b))};return this};b.prototype.promise=
function(a){var b=this;return new Promise(function(c,e){b.xhr.onreadystatechange=function(a){b.isCompleted()&&(b.isSuccessResponse()?c(b):e(b))};b.send(a)})};b.prototype.readyState=function(){return this.xhr.readyState};b.prototype.status=function(){return this.xhr.status};b.prototype.responseHeaders=function(){return this.xhr.getAllResponseHeaders()};b.prototype.responseHeader=function(a){return this.xhr.getResponseHeader(a)};b.prototype.responseText=function(){return this.xhr.responseText};b.prototype.response=
function(){return this.xhr.response};b.prototype.responseType=function(a){if("string"!=typeof a)return this.xhr.responseType;this.xhr.responseType=a;return this};b.prototype.send=function(a){if(this.url)if(a||this.postData){this.xhr.open(this.method||"POST",this.url,!0,this.userName,this.password);for(var b in this.headers)this.xhr.setRequestHeader(b,this.headers[b]);this.xhr.send(a||this.postData)}else{this.xhr.open(this.method||"GET",this.url,!0,this.userName,this.password);for(var d in this.headers)this.xhr.setRequestHeader(d,
this.headers[d]);this.xhr.send()}else throw Error("The request URL is empty");return this};b.prototype.abort=function(){this.xhr.abort();return this};b.prototype.isCompleted=function(){return this.xhr.readyState==XMLHttpRequest.DONE||this.xhr.readyState==this.xhr.DONE};b.prototype.isStatusOK=function(){return 200<=this.xhr.status&&300>this.xhr.status};b.prototype.isSuccessResponse=function(){return this.isStatusOK()&&(!this.xhr.responseType||null!==this.xhr.response&&void 0!==this.xhr.response)};
b.prototype.errorState=function(a){return this.status()?this.isStatusOK()?this.isSuccessResponse()?a?"No error":this.ERR_NONE:a?"Unexpected response body format":this.ERR_BODYTYPE:a?"HTTP "+this.status():this.ERR_HTTPSTATUS:a?"Connection failed":this.ERR_CONNECTION};e&&(b.prototype.loadInto=function(a,b,d){b&&"function"==typeof this.showPreloader&&this.showPreloader(a);this.responseType("").onReady(function(){"string"==typeof a&&a.length&&(a=document.querySelector(a));if("object"!=typeof a||!(a instanceof
Element))throw Error("Invalid node element / CSS selector");this.isStatusOK()?a.innerHTML=this.xhr.responseText:a.innerHTML="function"==typeof d?d(this)||"":d||""}).send();return this},b.prototype.showPreloader=function(a){"string"==typeof a&&a.length&&(a=document.querySelector(a));"object"==typeof a&&a instanceof Element&&(a.innerHTML='<div class="xhr_preloader" id="xhr_preloader_'+a.id+'" style="height:'+a.clientHeight+"px;width:"+a.clientWidth+'px;margin:0px;padding:0px;"></div>');return this});
if(e)window[g]=b;else if(f)module.exports=b;else throw Error("Unsupported environment");})("XHR");
