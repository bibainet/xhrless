(function(k){var f="object"==typeof window&&"object"==typeof document,h="object"==typeof module&&"function"==typeof require;if("undefined"==typeof XMLHttpRequest)if(h)XMLHttpRequest=require("xhr2"),"object"==typeof XMLHttpRequest.prototype._restrictedHeaders&&["cookie","cookie2","referer","user-agent"].forEach(function(a){return delete XMLHttpRequest.prototype._restrictedHeaders[a]});else throw Error("XMLHttpRequest is not defined in this environment");var b=function(a,c,g){if("object"!=typeof this||
!(this instanceof b))return new b(a,c,g);this.xhr=new XMLHttpRequest;this.method=g||"";this.url=a||"";this.postData=c||void 0;this.password=this.userName=void 0;this.headers={};this.data={}};b.prototype.ERR_NONE=0;b.prototype.ERR_CONNECTION=1;b.prototype.ERR_HTTPSTATUS=2;b.prototype.ERR_BODYTYPE=3;b.prototype.reset=function(a,c,b){this.method=b||"";this.url=a||"";this.postData=c||void 0;return this};b.prototype.httpAuth=function(a,c){this.userName=a;this.password=c;return this};b.prototype.setTimeout=
function(a){this.xhr.timeout="number"==typeof a&&0<a?a:0;return this};b.prototype.setData=function(a,c){"string"==typeof a&&a.length&&(void 0!==c?this.data[a]=c:this.data.hasOwnProperty(a)&&delete this.data[a]);return this};b.prototype.setHeader=function(a,c){"string"==typeof a&&a.length&&("string"==typeof c&&c.length?this.headers[a]=c:this.headers.hasOwnProperty(a)&&delete this.headers[a]);return this};b.prototype.setHeaders=function(a){this.headers={};if("object"==typeof a)for(var c in a)a.hasOwnProperty(c)&&
"string"==typeof a[c]&&a[c].length&&(this.headers[c]=a[c]);return this};b.prototype.setCookie=function(a,c){"string"==typeof a&&a.length&&"string"==typeof c&&c.length&&(this.headers.Cookie="Cookie"in this.headers?this.headers.Cookie+("; "+a+"="+encodeURIComponent(c)):a+"="+encodeURIComponent(c));return this};b.prototype.setCookies=function(a){var c=[];if("object"==typeof a)for(var b in a)a.hasOwnProperty(b)&&"string"==typeof a[b]&&a[b].length&&c.push(b+"="+encodeURIComponent(a[b]));c.length?this.headers.Cookie=
c.join("; "):this.headers.hasOwnProperty("Cookie")&&delete this.headers.Cookie;return this};b.prototype.onTimeout=function(a){var c=this;this.xhr.ontimeout="function"==typeof a?function(b){return a.call(c,c)}:null;return this};b.prototype.onChange=function(a){var c=this;this.xhr.onreadystatechange="function"==typeof a?function(b){return a.call(c,c)}:null;return this};b.prototype.onReady=function(a){var c=this;this.xhr.onreadystatechange="function"==typeof a?function(b){return c.isCompleted()&&a.call(c,
c)}:null;return this};b.prototype.onSuccess=function(a,c,b){var d=this;a="function"==typeof a?a:null;c="function"==typeof c?c:null;b="function"==typeof b?b:null;this.xhr.onreadystatechange=a||c||b?function(g){d.isCompleted()&&(d.isSuccessResponse()?a&&a.call(d,d):c&&c.call(d,d),b&&b.call(d,d))}:null;return this};b.prototype.promise=function(a){var c=this;return new Promise(function(b,d){c.xhr.onreadystatechange=function(a){c.isCompleted()&&(c.isSuccessResponse()?b(c):d(c))};c.send(a)})};b.prototype.readyState=
function(){return this.xhr.readyState};b.prototype.status=function(){return this.xhr.status};b.prototype.responseHeaders=function(a){if(!a)return this.xhr.getAllResponseHeaders();a=this.xhr.getAllResponseHeaders().split("\n");for(var c={},b,d,e=0,f=a.length;e<f;++e)d=a[e].indexOf(":"),0<d&&(b=a[e].substr(0,d).trim(),d=a[e].substr(d+1).trim(),b.length&&d.length&&(c.hasOwnProperty(b)?c[b].push(d):c[b]=[d]));return c};b.prototype.responseHeader=function(a){return this.xhr.getResponseHeader(a)};b.prototype.responseText=
function(){return this.xhr.responseText};b.prototype.response=function(){return this.xhr.response};b.prototype.responseType=function(a){if("string"!=typeof a)return this.xhr.responseType;this.xhr.responseType=a;return this};b.prototype.send=function(a){if(this.url)if(a||this.postData){this.xhr.open(this.method||"POST",this.url,!0,this.userName,this.password);for(var c in this.headers)this.xhr.setRequestHeader(c,this.headers[c]);this.xhr.send(a||this.postData)}else{this.xhr.open(this.method||"GET",
this.url,!0,this.userName,this.password);for(c in this.headers)this.xhr.setRequestHeader(c,this.headers[c]);this.xhr.send()}else throw Error("The request URL is empty");return this};b.prototype.abort=function(){this.xhr.abort();return this};b.prototype.isCompleted=function(){return this.xhr.readyState&&(this.xhr.readyState==XMLHttpRequest.DONE||this.xhr.readyState==this.xhr.DONE)};b.prototype.isStatusOK=function(){return 200<=this.xhr.status&&300>this.xhr.status};b.prototype.isSuccessResponse=function(){return this.isStatusOK()&&
(!this.xhr.responseType||null!==this.xhr.response&&void 0!==this.xhr.response)};b.prototype.errorState=function(a){return this.status()?this.isStatusOK()?this.isSuccessResponse()?a?"No error":this.ERR_NONE:a?"Unexpected response body format":this.ERR_BODYTYPE:a?"HTTP "+this.status():this.ERR_HTTPSTATUS:a?"Connection failed":this.ERR_CONNECTION};f&&(b.prototype.loadInto=function(a,c,b){c&&"function"==typeof this.showPreloader&&this.showPreloader(a);this.responseType("").onReady(function(){"string"==
typeof a&&a.length&&(a=document.querySelector(a));if("object"!=typeof a||!(a instanceof Element))throw Error("Invalid node element / CSS selector");this.isStatusOK()?a.innerHTML=this.xhr.responseText:a.innerHTML="function"==typeof b?b(this)||"":b||""}).send();return this},b.prototype.showPreloader=function(a){"string"==typeof a&&a.length&&(a=document.querySelector(a));"object"==typeof a&&a instanceof Element&&(a.innerHTML='<div class="xhr_preloader" id="xhr_preloader_'+a.id+'" style="height:'+a.clientHeight+
"px;width:"+a.clientWidth+'px;margin:0px;padding:0px;"></div>');return this});if(f)window[k]=b;else if(h)module.exports=b;else throw Error("Unsupported environment");})("XHR");
