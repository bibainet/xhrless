(function(k){var f="object"==typeof window&&"object"==typeof document,h="object"==typeof module&&"function"==typeof require;if("undefined"==typeof XMLHttpRequest)if(h)XMLHttpRequest=require("xhr2"),"object"==typeof XMLHttpRequest.prototype._restrictedHeaders&&["cookie","cookie2","referer","user-agent"].forEach(function(a){return delete XMLHttpRequest.prototype._restrictedHeaders[a]});else throw Error("XMLHttpRequest is not defined in this environment");var c=function(a,b,g){if("object"!=typeof this||
!(this instanceof c))return new c(a,b,g);this.xhr=new XMLHttpRequest;this.method=g||"";this.url=a||"";this.postData=b||void 0;this.password=this.userName=void 0;this.headers={};this.data={}};c.prototype.ERR_NONE=0;c.prototype.ERR_CONNECTION=1;c.prototype.ERR_HTTPSTATUS=2;c.prototype.ERR_BODYTYPE=3;c.prototype.toString=function(){return"[object XHR] "+(this.method?this.method:this.postData?"POST":"GET")+" "+(this.url?this.url:"-")+" "+this.readyState()+" "+this.status()};c.prototype.reset=function(a,
b,c){this.method=c||"";this.url=a||"";this.postData=b||void 0;return this};c.prototype.httpAuth=function(a,b){this.userName=a;this.password=b;return this};c.prototype.setTimeout=function(a){this.xhr.timeout="number"==typeof a&&0<a?a:0;return this};c.prototype.setData=function(a,b){"string"==typeof a&&a.length&&(void 0!==b?this.data[a]=b:this.data.hasOwnProperty(a)&&delete this.data[a]);return this};c.prototype.setHeader=function(a,b){"string"==typeof a&&a.length&&("string"==typeof b&&b.length?this.headers[a]=
b:this.headers.hasOwnProperty(a)&&delete this.headers[a]);return this};c.prototype.setHeaders=function(a){this.headers={};if("object"==typeof a)for(var b in a)a.hasOwnProperty(b)&&"string"==typeof a[b]&&a[b].length&&(this.headers[b]=a[b]);return this};c.prototype.setCookie=function(a,b){"string"==typeof a&&a.length&&"string"==typeof b&&b.length&&(this.headers.Cookie="Cookie"in this.headers?this.headers.Cookie+("; "+a+"="+encodeURIComponent(b)):a+"="+encodeURIComponent(b));return this};c.prototype.setCookies=
function(a){var b=[];if("object"==typeof a)for(var c in a)a.hasOwnProperty(c)&&"string"==typeof a[c]&&a[c].length&&b.push(c+"="+encodeURIComponent(a[c]));b.length?this.headers.Cookie=b.join("; "):this.headers.hasOwnProperty("Cookie")&&delete this.headers.Cookie;return this};c.prototype.onTimeout=function(a){var b=this;this.xhr.ontimeout="function"==typeof a?function(c){return a.call(b,b)}:null;return this};c.prototype.onChange=function(a){var b=this;this.xhr.onreadystatechange="function"==typeof a?
function(c){return a.call(b,b)}:null;return this};c.prototype.onReady=function(a){var b=this;this.xhr.onreadystatechange="function"==typeof a?function(c){return b.isCompleted()&&a.call(b,b)}:null;return this};c.prototype.onSuccess=function(a,b,c){var d=this;a="function"==typeof a?a:null;b="function"==typeof b?b:null;c="function"==typeof c?c:null;this.xhr.onreadystatechange=a||b||c?function(g){d.isCompleted()&&(d.isSuccessResponse()?a&&a.call(d,d):b&&b.call(d,d),c&&c.call(d,d))}:null;return this};
c.prototype.promise=function(a){var b=this;return new Promise(function(c,d){b.xhr.onreadystatechange=function(a){b.isCompleted()&&(b.isSuccessResponse()?c(b):d(b))};b.send(a)})};c.prototype.readyState=function(){return this.xhr.readyState};c.prototype.status=function(){return this.xhr.status};c.prototype.responseHeaders=function(a){if(!a)return this.xhr.getAllResponseHeaders();a=this.xhr.getAllResponseHeaders().split("\n");for(var b={},c,d,e=0,f=a.length;e<f;++e)d=a[e].indexOf(":"),0<d&&(c=a[e].substr(0,
d).trim(),d=a[e].substr(d+1).trim(),c.length&&d.length&&(b.hasOwnProperty(c)?b[c].push(d):b[c]=[d]));return b};c.prototype.responseHeader=function(a){return this.xhr.getResponseHeader(a)};c.prototype.responseText=function(){return this.xhr.responseText};c.prototype.response=function(){return this.xhr.response};c.prototype.responseType=function(a){if("string"!=typeof a)return this.xhr.responseType;this.xhr.responseType=a;return this};c.prototype.send=function(a){if(a||this.postData){this.xhr.open(this.method||
"POST",this.url,!0,this.userName,this.password);for(var b in this.headers)this.xhr.setRequestHeader(b,this.headers[b]);this.xhr.send(a||this.postData)}else{this.xhr.open(this.method||"GET",this.url,!0,this.userName,this.password);for(b in this.headers)this.xhr.setRequestHeader(b,this.headers[b]);this.xhr.send()}return this};c.prototype.abort=function(){this.xhr.abort();return this};c.prototype.isCompleted=function(){return this.xhr.readyState&&(this.xhr.readyState==XMLHttpRequest.DONE||this.xhr.readyState==
this.xhr.DONE)};c.prototype.isStatusOK=function(){return 200<=this.xhr.status&&300>this.xhr.status};c.prototype.isSuccessResponse=function(){return this.isStatusOK()&&(!this.xhr.responseType||null!==this.xhr.response&&void 0!==this.xhr.response)};c.prototype.errorState=function(a){return this.status()?this.isStatusOK()?this.isSuccessResponse()?a?"No error":this.ERR_NONE:a?"Unexpected response body format":this.ERR_BODYTYPE:a?"HTTP "+this.status():this.ERR_HTTPSTATUS:a?"Connection failed":this.ERR_CONNECTION};
f&&(c.prototype.loadInto=function(a,b,c){"string"==typeof a&&(a=document.querySelector(a));if("object"!=typeof a||!(a instanceof Element))throw Error("Invalid element / CSS selector");b&&this.showPreloader(a,"string"==typeof b?b:"");return this.responseType("").onReady(function(){a["value"in a?"value":"innerHTML"]=this.isStatusOK()?this.xhr.responseText:("function"==typeof c?c(this):c)||""}).send()},c.prototype.showPreloader=function(a,b){"string"==typeof a&&(a=document.querySelector(a));if("object"!=
typeof a||!(a instanceof Element))throw Error("Invalid element / CSS selector");"string"!=typeof b&&(b="");"value"in a?a.value=b:a.innerHTML='<div class="xhr_preloader" id="xhr_preloader_'+a.id+'" style="height:'+a.clientHeight+"px;width:"+a.clientWidth+'px;">'+b+"</div>";return this},c.prototype.loadForm=function(a){"string"==typeof a&&(a=document.querySelector(a));if("object"!=typeof a||!(a instanceof HTMLFormElement))throw Error("Invalid element / CSS selector");return this.reset(a.action,new FormData(a),
a.method||"POST")},c.prototype.formValue=function(a,b,c){if("string"!=typeof a||!a.length)return this;"object"==typeof this.postData&&this.postData instanceof FormData||(this.postData=new FormData);void 0===b?this.postData["delete"](a):"string"==typeof c?this.postData.append(a,b,c):this.postData.append(a,b);return this});if(f)window[k]=c;else if(h)module.exports=c;else throw Error("Unsupported environment");})("XHR");
